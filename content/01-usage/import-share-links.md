---
title: "导入链接（重要）"
date: 2020-02-01T17:39:27+08:00
draft: false
weight: 40
---

选项窗口的 “默认值” 分页可以修改导入链接的默认配置。
{{< figure src="../../images/forms/form_option_defaults.png" >}}
“入站模板” 对应 “模板” 分页的配置名字，软件自带了 config, http, socks 三种配置，可以自行修改、添加更多配置  
“自定义core” 对应 “多内核” 分页的配置名字  

##### 模板(分页)
{{< figure src="../../images/forms/form_custom_config_template_editor.png" >}}
上面是http配置模板示例。“合并方式” 只对 json 类型的模板生效。其中 `ByTag` 合并方式与 v2ray 的多文件配置类似。`ModifyOutbound` 合并方式比较特殊，请看 [前置代理]({{< relref "01-usage/front-proxy.md" >}})。合并时模板中的 `%host%` 和 `%port%` 将会替换成 “默认值” 分页中的 “入站地址”。模板不一定是 json，也可以是 yaml 或者任意 text。不过目前对 yaml 的支持比较弱鸡，只会简单的替换第一层 key。而 text 类型的模板则直接插入到 config 的顶部。这样看文字比较抽象，建议自己添加几个不同类型的模板，然后看服务器最终配置的变化。注意模板的类型要和服务器 config 的类型对应，如果把一个 yaml 类型的模板应用到一个 json 类型的 config 会无效。  

##### 最终配置
“Text编辑器” 里面看到的 config 是解码分享链接后生成的原始配置。在传给 core 前需要做点处理。比如，选项窗口中钩选了 uTLS，那么就要在 config 里面添加 fingerprint 配置项。还有流量统计、自签名证书以及 inbound 等设置也要转换成相应的配置合并进 config 里面。这样处理之后得到的就是 “最终配置”，即传给 core 的 config。  

##### 多内核(分页)
{{< figure src="../../images/forms/form_option_custom_core.png" >}}
这个软件默认支持 xray 和 v2ray v4.x 两种内核。其他内核可以自行在 “多内核” 分页里面添加。上面是一个 v2ray v5.x 的例子。这里配置完成后可以回 “默认值” 分页选择 “默认core”。使用自定义 core 时，流量统计功能失效。如果需要写盘 config 文件，注意文件名 `v5.json` 要和命令行参数一致。生成的配置文件 `v5.json` 位于软件目录内。  

###### 环境变量
可以用逗号分隔多个变量，例如：`A=123, B=abc`。等号两边不要加空格。 
  
###### 测速模板
测速的原理是启动一个入口为 HTTP 协议的代理服务器，然后测量通过这个代理去下载网页所用的时间。不同 core 的配置格式有所不同，所以不能直接套用 xray/v2ray 的 inbound 配置。用户可以给自定义 core 编写合适的 inbound 来支持测速功能。配置编写方式参考软件自带的 http 模板。测速时 `%host%` 将替换为 `127.0.0.1`, `%port%` 替换为随机端口。为了兼容旧版本，测速模板有个 “无” 选项。它其实是 xray/v2ray 的 HTTP inbound。  
`v1.8.8` 起支持通过 SOCKS5 协议测速，注意模板配置界面要钩上 SOCKS5 选项。这个选项仅在把该模板设置为自定义 core 的 “测速模板” 时有效。  

###### “文件”（钩选项）
钩上这个选项后每次启动内核前都会把最终配置写盘成文件。  

通过写盘 config 文件的方式启动内核是有 bug 的。启动内核需要时间，如果这期间系统卡顿一下就有可能发生意外。比如连续启动 `#1`, `#2` 两个服务器，`#1` 服务器的config写盘然后启动但是系统卡顿了一下，`#2` 服务器接着写盘，这时 `#1` 服务器才启动同时 `#2` 服务器启动，于是 `#1` 和 `#2` 服务器都读取了 `#2` 服务器的 config 文件，结果通常是其中一个服务器因为端口冲突而启动失败。要是通过 `stdin:` 方式传入 config 就不会发生这样的问题。为了降低这个 bug 的发生概率，V2RayGCon 每次写盘后都要等待3秒钟，其实这个时间有时是不够的，所以只是降低概率并没有修复这个 bug。但是这个时间也不可以设置得太长。因为 3 秒就意味着一个小时最多进行 1200 次测速，如果每个服务器测 3 次那么就是只能测 400 个服务器。测速是并发进行的，不能写一次盘测 3 次。不知道哪个大聪明把 v2ray-core v5.x 的从 `stdin:` 读取配置功能改废了，每小时 1200 次写盘啊！！！  

##### 导入以后修改设置
上面的设置仅对新导入的服务器生效，已经导入的服务器可以在服务器设置面板中修改相应的设置。  
{{< figure src="../../images/forms/form_settings_and_qrcode.png" >}}
“*Inbound” 对应选项窗口 “默认值” 分页中的 “入站模板” 和 “入站地址”。  
“*内核名” 对应选项窗口 “默认值” 分页中的 “自定义core”。  
“*模板” 用于给服务器添加通用配置。假设我想给某几个服务器添加 routing 配置，那么先在选项窗口里面添加一个名为 routing 的模板。然后在上面的窗口中点 “*模板” 按钮，勾选 routing 模板就行。合并后的配置在 “最终配置” 里面查看。  

提示：点击青色的 (http) 标签快速调出服务器设置窗口。

##### 同时修改多个服务器
{{< figure src="../../images/forms/form_batch_modify.png" >}}
钩选多个服务器然后点击 “主窗口” - “服务器” - “批量修改”。 
